<!DOCTYPE html>
<html>

<head>
    <title>Opioids In The US</title>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="image/png" href="../src/resources/favicon.png">
    <link rel="stylesheet" href="../src/index.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
<script src="https://d3js.org/d3.v4.js"></script>

 
</head>

<body>
    <div class="page">
        <!-- HEADER BEGIN -->
        <div class="header">
            <h1>Opioid Use In The U.S.</h1>
            <a href="https://github.com/Thorup/datascience_group8" target="_blank"><img id="github-link-logo"
                    src="../src/resources/github.png" /></a>
        </div>
        <!-- HEADER END -->


        <div class="main-content">


            <!--INTRODUCTION TO PAGE -->
            <div class="intro">
                <div class="intro-container row text-center">
                    <div id="page-intro-right" class="page-intro col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                        <h2>Introduction</h2>
                        The United States is facing a national health crisis due to the rise in prescription drugs. Namely, opioids
                        such as Oxytocin and Hydrocodone, have been described as one of the major causes for this epidemic.
                        The Drug Enforcement Administration has released a database, that contains nearly 400 million transactions of opioids from the year 2006 to 2012. These transactions can be helpful to indicate where
                        the most problematic areas are located in the US. Furthermore, the transaction data can be combined
                        with other publicly available datasets to gain insights into everything from the correlations between the
                        sales of opioids and crime rate, homelessness and much more.</div>
                    <div class="page-intro col-12 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                        <h2>Datasets and Insights</h2>
                        In order to meet the project requirement of gaining additional insights of the data, it was decided to
                        collect an additional dataset, containing demographic data of the population in each state in the US.
                        The secondary dataset describes the development of the demographic on state level from the years 2007
                        to 2012. The following demographic attributes were collected:
                        <ul>
                            <li>Reported Crimes</li>
                            <li>Homelessness</li>
                            <li>Average Income</li>
                            <li>Unemployment</li>
                        </ul>
                    </div>
                </div>

            </div>
            <!--END OF INTRODUCTION-->


            <!--ALL MAPS AND CHARTS CONTAINER-->
            <div class="row">
<!--                <div class="map-container 
            col-offset-1
            col-sm-offset-1
            col-md-offset-1
            col-lg-offset-1
            col-xl-offset-1
        
        col-10 
        col-sm-10 
        col-md-10 
        col-lg-10 
        col-xl-10" id='heat-map-container'>
                    <div class="map-title col-12 col-md-12 col-lg-12 col-xl-12">
                        <h1>Opioid use in counties</h1>
                    </div>
                    <div class="map-play-wrapper">
                        <div class="map" id="county-choro" style="width:80vh; height: 45vh;"></div>
                        <button class="map-button btnPlay" id="btnPlayHeatMap"><i class="material-icons md-36">
                                play_arrow
                            </i></button>
                        <button class="map-button btnStop" id="btnStopHeatMap"><i class="material-icons md-36">
                                stop
                            </i></button>
                    </div>


                    <div class="row text-center">
                        <div class="map-information col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">This is me drawing
                            some
                            smart conclusion on what we can see on the
                            heatmap.
                            The heatmap shows something
                            about how the opioid crisis has evolved since 2007. How very interesting to see this on a
                            heatmap, I
                            feel much wiser. There should be some more filler
                            text to really simulate how much text we would like to have here
                        </div>
                    </div>

                </div>
            </div>
-->

            <div class="row text-center">
                <div class="map-container
            col-offset-1
            col-sm-offset-1
            col-md-offset-1
            col-lg-offset-1
            col-xl-offset-1
        
        col-10 
        col-sm-10 
        col-md-10 
        col-lg-10 
        col-xl-10" id="choro-container">
                    <div class="map-title col-12 col-md-12 col-lg-12 col-xl-12">
                        <h1>Opioid use in states</h1>
                    </div>
                    <div class="map-play-wrapper">
                        <div id="yearLabel"></div>
                        <div class="map" id='choro-map' style="width:80vh; height: 45vh;"></div>
                        <button class="map-button btnPlay" id="btnPlayChoroMap"><i class="material-icons md-36">
                                play_arrow
                            </i></button>
                        <button class="map-button btnStop" id="btnStopChoroMap"><i class="material-icons md-36">
                                stop
                            </i></button>
                    </div>

                    <div class="row text-center">
                        <div class="map-information col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">This is me drawing
                            some
                            smart conclusion on what we can see on the
                            heatmap.
                            The heatmap shows something
                            about how the opioid crisis has evolved since 2007. How very interesting to see this on a
                            heatmap, I
                            feel much wiser. There should be some more filler
                            text to really simulate how much text we would like to have here
                        </div>
                    </div>
                </div>

            </div>
            <div class="charts-container row text-center">
                <div class="chart-container"><div id="scatter" class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12"></div></div>
                <div class="chart-container"><div id="correlogram"></div></div>
            </div>
            <div class="chart-container" id="opioid-bar-chart-container">
                <div id="button-container"></div><div  id="opioid-bar-chart"></div>
                <div id="opioid-bar-chart-year-acc"></div>
            </div>
            <div id="opioid-line-chart"></div>
            <!--END OF MAPS AND CHARTS-->
  <div class="cluster-plot-container">
            <div id="homeless-cluster"></div>
            <div id="crime-cluster"></div>
            <div id="income-cluster"></div>
            <div id="unemp-cluster"></div>
          </div>

        </div>

        <!-- MODAL FOR DATA SOURCES -->
        <div class="modal" id="exampleModalCentered" tabindex="-1" role="dialog"
            aria-labelledby="exampleModalCenteredLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenteredLabel">Other Data Sources</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <ul>
                            <li><a href="https://www.hudexchange.info/resource/3031/pit-and-hic-data-since-2007/"
                                    target="_blank">Homeless Data</a></li>
                            <li><a href="https://www.bls.gov/bls/news-release/laus.htm" target="_blank">Unemployment
                                    Data</a></li>
                            <li><a href="https://fred.stlouisfed.org/release?rid=118" target="_blank">Population
                                    Data</a>
                            </li>
                            <li><a href="https://ucr.fbi.gov/crime-in-the-u.s" target="_blank">Crime Data</a>
                            </li>
                            <li><a href="https://www2.census.gov/programs-surveys/cps/techdocs/cpsmar19.pdf"
                                    target="_blank">Average Income Data</a></li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- END MODAL -->






        <!-- FOOTER -->
        <section id="footer">
            <div class="container">
                <div class="row">
                    <div class="col-6 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                        <h5>Contributors</h5>
                        <ul class="list-unstyled quick-links">
                            <li><a href="javascript:void();" target="_blank"><i
                                        class="fa fa-angle-double-right"></i>Jens
                                    Navne</a></li>
                            <li><a href="https://github.com/lhunniche" target="_blank"><i
                                        class="fa fa-angle-double-right"></i>Lasse Klevang</a></li>
                            <li><a href="https://github.com/FCBfreak" target="_blank"><i
                                        class="fa fa-angle-double-right"></i>Johan Jakobsen</a></li>
                            <li><a href="https://github.com/Xrosby" target="_blank"><i
                                        class="fa fa-angle-double-right"></i>Mads Norby</a></li>
                        </ul>
                    </div>
                    <div class="col-6 col-sm-6 col-md-6 col-lg-6 col-xl-6">
                        <h5 id="footer-title-right">Project links</h5>
                        <ul class="list-unstyled quick-links">
                            <li><a href="https://github.com/Thorup/datascience_group8" target="_blank"><i
                                        class="fa fa-angle-double-right"></i>Project GitHub</a></li>
                            <li><a href="https://pdfhost.io/v/AlUJPYtm_outputpdf.pdf" target="_blank"><i
                                        class="fa fa-angle-double-right"></i>Project Documentation</a></li>
                            <li><a href="https://www.kaggle.com/paultimothymooney/pain-pills-in-the-usa?fbclid=IwAR20v_OL3gkUuTWlGex-xMyWcOplxYciJ_tXO4_wX4kZVUI-VjRi4WZLbE8"
                                    target="_blank"><i class="fa fa-angle-double-right"></i>Opioid Data Source</a>
                            </li>
                            <li><a href="" id="data-sources-link" target="_blank" data-toggle="modal"
                                    data-target="#exampleModalCentered"><i class="fa fa-angle-double-right"></i>Other
                                    Data
                                    Sources</a></li>
                        </ul>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-sm-12 col-md-12 mt-12 mt-sm-12 text-center text-white">
                        <p><u><a href="https://www.sdu.dk/en">University Of Southern Denmark</a></u> in Odense
                            Denmark
                        </p>
                    </div>
                    </hr>
                </div>
            </div>
        </section>
        <!-- END FOOTER -->

    </div>
</body>

<script> 
    let csvSource = "correlation_table.csv"
    d3.csv(csvSource, function(error, rows) {
      var data = [];

      rows.forEach(function(d) {
        var x = d[""];
        delete d[""];
        for (prop in d) {
          var y = prop,
            value = d[prop];
          data.push({
            x: x,
            y: y,
            value: +value
          });
        }
      });
      
      var margin = {
          top: 50,
          right: 120,
          bottom: 50,
          left: 50
        },
        width = 1200 - margin.left - margin.right,
        height = 1200 - margin.top - margin.bottom,
        domain = d3.set(data.map(function(d) {
          return d.x
        })).values(),
        num = Math.sqrt(data.length),
             color = d3.scaleLinear()
                .domain([-1, 0, 1])
                .range(["#B22222", "#fff", "#000080"]);

             var x = d3.scalePoint()
            .range([0, width])
            .domain(domain),

            y = d3.scalePoint()
                .range([0, height])
                .domain(domain),
            xSpace = x.range()[1] - x.range()[0],
            ySpace = y.range()[1] - y.range()[0];
      ySpace = y.range()[1] - y.range()[0];

      var svg = d3.select("#correlogram")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var cor = svg.selectAll(".cor")
        .data(data)
        .enter()
        .append("g")
        .attr("class", "cor")
        .attr("transform", function(d) {
          return "translate(" + x(d.x) + "," + y(d.y) + ")";
        });

    
      cor.filter(function(d){
          var ypos = domain.indexOf(d.y);
          var xpos = domain.indexOf(d.x);
          for (var i = (ypos + 1); i < num; i++){
            if (i === xpos) return false;
          }
          return true;
        })
        .append("text")
        .attr("y", 5)
        .text(function(d) {
          if (d.x === d.y) {
            return d.x;
          } else {
            return d.value.toFixed(2);
          }
        })
        .style("fill", function(d){
          if (d.value === 1) {
            return "#000";
          } else {
            return color(d.value);
          }
        });

        cor.filter(function(d){
          var ypos = domain.indexOf(d.y);
          var xpos = domain.indexOf(d.x);
          for (var i = (ypos + 1); i < num; i++){
            if (i === xpos) return true;
          }
          return false;
        })
        .append("circle")
        .attr("r", function(d){
          return (width / (num * 2)) * (Math.abs(d.value) + 0.1);
        })
        .style("fill", function(d){
          if (d.value === 1) {
            return "#000";
          } else {
            return color(d.value);
          }
        });
        
     var aS = d3.scaleLinear()
            .range([-margin.top + 5, height + margin.bottom - 5])
            .domain([1, -1]);
            
   var yA = d3.axisRight()
            .scale(aS)
            .tickPadding(7);

    var aG = svg.append("g")
      .attr("class", "y axis")
      .call(yA)
      .attr("transform", "translate(" + (width + margin.right / 2) + " ,0)")

    var iR = d3.range(-1, 1.01, 0.01);
    var h = height / iR.length + 3;
    iR.forEach(function(d){
        aG.append('rect')
          .style('fill',color(d))
          .style('stroke-width', 0)
          .style('stoke', 'none')
          .attr('height', h)
          .attr('width', 10)
          .attr('x', 0)
          .attr('y', aS(d))
      });
    });
/*
      // Graph dimension
      var margin = {top: 20, right: 20, bottom: 20, left: 20},
        width = 1200 - margin.left - margin.right,
        height = 1200 - margin.top - margin.bottom
    
    // Create the svg area
    var svg = d3.select("#correlogram")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
    
    d3.csv(csvSource, function(error, rows) {
    
      // Going from wide to long format
      var data = [];
      rows.forEach(function(d) {
        var x = d[""];
        delete d[""];
        for (prop in d) {
          var y = prop,
            value = d[prop];
          data.push({
            x: x,
            y: y,
            value: +value
          });
        }
      });
    
      // List of all variables and number of them
      var domain = d3.set(data.map(function(d) { return d.x })).values()
      var num = Math.sqrt(data.length)
    
      // Create a color scale
      var color = d3.scaleLinear()
        .domain([-1, 0, 1])
        .range(["#B22222", "#fff", "#000080"]);
    
      // Create a size scale for bubbles on top right. Watch out: must be a rootscale!
      var size = d3.scaleSqrt()
        .domain([0, 1])
        .range([0, 9]);
    
      // X scale
      var x = d3.scalePoint()
        .range([0, width])
        .domain(domain)
    
      // Y scale
      var y = d3.scalePoint()
        .range([0, height])
        .domain(domain)
    
      // Create one 'g' element for each cell of the correlogram
      var cor = svg.selectAll(".cor")
        .data(data)
        .enter()
        .append("g")
          .attr("class", "cor")
          .attr("transform", function(d) {
            return "translate(" + x(d.x) + "," + y(d.y) + ")";
          });
    
      // Low left part + Diagonal: Add the text with specific color
      cor
        .filter(function(d){
          var ypos = domain.indexOf(d.y);
          var xpos = domain.indexOf(d.x);
          return xpos <= ypos;
        })
        .append("text")
          .attr("y", 5)
          .text(function(d) {
            if (d.x === d.y) {
              return d.x;
            } else {
              return d.value.toFixed(2);
            }
          })
          .style("font-size", 15).style("font-weight", 800)
          .style("text-align", "center")
          .style("fill", function(d){
            if (d.x === d.y) {
              return "#000";
            } else {
              return color(d.value);
            }
          });
    
    
      // Up right part: add circles
      cor
        .filter(function(d){
          var ypos = domain.indexOf(d.y);
          var xpos = domain.indexOf(d.x);
          return xpos > ypos;
        })
        .append("circle")
          .attr("r", function(d){ return size(Math.abs(d.value) * 2.9 + 1.5) })
          .style("fill", function(d){
            if (d.x === d.y) {
              return "#000";
            } else {
              return color(d.value);
            }
          })
          .style("opacity", 1)
    
    })
    
    */
    </script>
<script src="main.js"></script>


</html>